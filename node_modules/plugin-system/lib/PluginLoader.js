var EventEmitter 	= require('events').EventEmitter;
var util 			= require('util');
var path 			= require('path');
var fs				= require('fs');

function PluginLoader(dir) {
	
	this.dir = dir;
	
	fs.readdir(this.dir, function(error, files) {
		
		files.forEach(function(file, index, array) {
			
			if(fs.lstatSync(this.dir + path.sep + file).isDirectory())
				this.readDir(this.dir + path.sep + file);
		}.bind(this));
	}.bind(this));
}

util.inherits(PluginLoader, EventEmitter);

PluginLoader.prototype.readDir = function(dir) {
	
	fs.readdir(dir, function(error, files) {
		
		if(files.indexOf('plugin.json') > -1) {
			
			var info = JSON.parse(fs.readFileSync('.' + path.sep + dir + path.sep + 'plugin.json'));
			
			console.log(info);
			
			this.emit('plugin', info, dir);
		}
	}.bind(this));
}

module.exports = PluginLoader;